@using BusTrips.Web.Models
@model BusTrips.Web.Models.ResetPasswordViewModel

@{
    ViewBag.Title = "Reset Password";
    Layout = null;
}

<!doctype html>
<html lang="en" data-layout="vertical" data-topbar="light" data-sidebar="light" data-sidebar-size="lg">
<head>
    @Html.Partial("~/Views/Shared/_title_meta.cshtml")
    @Html.Partial("~/Views/Shared/_head_css.cshtml")
</head>
<body>
    @await Html.PartialAsync("_Alert", new AlertViewModel { IsSuccess = ViewBag.IsSuccess ?? false, Message = ViewBag.Message as string }
        )
    <!-- auth-page wrapper -->
    <div class="auth-page-wrapper auth-bg-cover py-5 d-flex justify-content-center align-items-center min-vh-100">
        <div class="bg-overlay"></div>
        <!-- auth-page content -->
        <div class="auth-page-content overflow-hidden pt-lg-5">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card overflow-hidden border-0">
                            <div class="row justify-content-center g-0">
                                <div class="col-lg-6">
                                    <div class="p-lg-5 p-4 auth-one-bg h-100">
                                        <div class="bg-overlay"></div>
                                        <div class="position-relative h-100 d-flex flex-column">
                                            <div class="mb-4">
                                                <a href="@Url.Action("Index", "Account")" class="d-block  text-white">
                                                    @* <img src="~/assets/images/logo-dark.png" alt="" height="40"> *@
                                                    Charter Bus
                                                </a>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <!-- end col -->

                                <div class="col-lg-6">
                                    <div class="p-lg-5 p-4">
                                        <h5 class="text-primary">Create new password</h5>
                                        <p class="text-muted">Your new password must be different from previous used password.</p>

                                        <div class="p-2">
                                            <form id="resetPasswordForm" method="post" novalidate>
                                                <input asp-for="Token" type="hidden" value="@Model.Token" />
                                                <input asp-for="Email" type="hidden" value="@Model.Email" />

                                                <div class="mb-3">
                                                    <label asp-for="Password" class="form-label">Password</label>
                                                    <div class="position-relative auth-pass-inputgroup">
                                                        <input type="password" class="form-control pe-5 password-input" placeholder="Enter new password" asp-for="Password" tabindex="1"
                                                               oncopy="return false;"
                                                               oncut="return false;"
                                                               onpaste="return false;">
                                                        <button class="btn btn-link position-absolute end-0 top-0 text-decoration-none text-muted password-addon" type="button" id="password-addon1"><i class="ri-eye-fill align-middle"></i></button>
                                                    </div>
                                                    <span asp-validation-for="Password" class="text-danger"></span>
                                                </div>

                                                <div class="mb-3">
                                                    <label asp-for="ConfirmPassword" class="form-label">Confirm Password</label>
                                                    <div class="position-relative auth-pass-inputgroup">
                                                        <input type="password" class="form-control pe-5 password-input" placeholder="Enter password" asp-for="ConfirmPassword" tabindex="2"
                                                               oncopy="return false;"
                                                               oncut="return false;"
                                                               onpaste="return false;">
                                                        <button class="btn btn-link position-absolute end-0 top-0 text-decoration-none text-muted password-addon" type="button" id="password-addon2"><i class="ri-eye-fill align-middle"></i></button>
                                                    </div>
                                                    <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                                                </div>
                                                <div class="mt-4">
                                                    <button type="submit" class="btn btn-primary w-100">Reset Password</button>
                                                </div>
                                            </form>

                                        </div>
                                        <div id="resetPasswordMessage" class="mt-2"></div>

                                        <div class="mt-5 text-center">
                                            <p class="mb-0">Wait, I remember my password... <a href="@Url.Action("LoginUser", "Account")" class="fw-semibold text-primary text-decoration-underline"> Click here </a> </p>
                                        </div>
                                    </div>
                                </div>
                                <!-- end col -->
                            </div>
                            <!-- end row -->
                        </div>
                        <!-- end card -->
                    </div>
                    <!-- end col -->

                </div>
                <!-- end row -->
            </div>
            <!-- end container -->
        </div>
        <!-- end auth page content -->
        <!-- footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="text-center">
                            <p class="mb-0"><script>document.write(new Date().getFullYear())</script> © Charter Bus.</p>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- end Footer -->
    </div>
    <!-- end auth-page-wrapper -->
    @Html.Partial("~/Views/Shared/_vendor_scripts.cshtml")

    <script src="~/assets/js/pages/form-validation.init.js"></script>
    <script src="~/assets/js/pages/password-addon.init.js"></script>

    <script>
        $(document).ready(function () {
            $("#resetPasswordForm").submit(function (e) {
                e.preventDefault();

                var form = $(this);
                var formData = form.serialize();

                // Clear previous messages
                $(".text-danger").text('');

                $.ajax({
                    url: "@Url.Action("ResetPassword", "Account")",
                    type: "POST",
                    data: formData,
                    success: function (res) {
                        if (res.isSuccess) {
                            if (res.redirectUrl) {
                                window.location.href = res.redirectUrl;
                            } else {
                                alert("Password reset successfully!");
                            }
                        } else if (res.errors) {
                            // Field-level errors
                            $.each(res.errors, function (key, messages) {
                                // Find the span by data-valmsg-for attribute
                                $(`span[data-valmsg-for="${key}"]`).text(messages[0]);
                            });
                        } else if (res.message) {
                            // General error
                            alert(res.message);
                        }
                    },
                    error: function () {
                        alert("Something went wrong.");
                    }
                });
            });
        });
    </script>

</body>
</html>